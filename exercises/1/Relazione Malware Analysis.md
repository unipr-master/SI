
Di seguito viene fornita una breve relazione sullo studio effettuato degli strumenti per l'analisi dei malware visti a lezione

### VirusTotal

Il file utilizzato per l’analisi di **VirusTotal** è il setup di Telegram Desktop per macOS

![[Screenshot 2024-09-24 alle 12.15.57.png]]


Ad una prima ispezione, il file testato non presenta nessun indicatore che suggerisca intenti malevoli del file 


![[Screenshot 2024-09-24 alle 12.16.28.png]]

Approfondendo l'analisi, VirusTotal le firme **MD5, SHA-1, SHA-256** del file. Questi hash servono a verificare l’integrità e l’autenticità del file, permettendo di confrontarli con database di malware noti.

VirusTotal ci mostra poi che il file è un’immagine disco di Macintosh (Macintosh Disk Image) di  dimensione 109.23 MB. Questa dimensione è coerente con le aspettative rispetto a questo tipo di file. Un indicatore anomalo ci avrebbe invece suggerito che del codice malevolo potrebbe essere nascosto all'interno dell'eseguibile (e.g. trojan)

VirusTotal segnala che il file è stato identificato come **tsetup.5.5.5.dmg** e **telegram-for-desktop-5-5-5.dmg**, indicando che si tratta realmente del setup di Telegram Desktop.


![[Screenshot 2024-09-24 alle 12.16.51.png]]

In questo caso, oltre a verificare informazioni come il **CFBundleIdentifier**, il **CFBundleExecutable** e il **CFBundleGetInfoString**, che sembrano confermare la legittimità dell'eseguibile, notiamo che l'applicativo richiede l'accesso al microfono, alla camera del pc e alla nostra posizione. Tuttavia, come spiegato nei rispettivi campi (**NSMicrophoneUsageDescription**, **NSCameraUsageDescription** e **NSLocationUsageDescription**), l'utilizzo di questi servizi sembra legittimo e coerente con il funzionamento dell'applicazione

![[ip.png|600]]

Questa schermata mostra invece un elenco di indirizzi IP con i quali il processo avviato dal file ha stabilito una connessione. Notiamo che tutti gli indirizzi provengono dagli Stati Uniti e che nessuno indicato come sospetto o malevolo.


![[Screenshot 2024-09-24 alle 12.18.11.png]]


Per concludere, il rapporto di VirusTotal, basato su un’analisi comportamentale in ambienti sandbox (OS X Sandbox e Zenbox macOS), non rileva minacce dirette.

Tuttavia, viene segnalato un comportamento potenzialmente rischioso: una richiesta DNS a un server di Apple (apple.com) per un record TXT, indicata come possibile violazione della privacy  (`privacy-violation`). In realtà, questa richiesta è plausibile e dimostra che Apple verifica l’autenticità dell’applicazione. Il file ha anche eseguito una scansione delle porte aperte (`port-scan`)  e stabilito una comunicazione TCP  (`stream-tcp`), che potrebbe sembrare sospetta, ma è coerente con la richiesta DNS fatta ai server Apple (abbiamo inoltre già appurato che gli indirizzi IP utilizzati sono legittimi)


### AnyRun

Per quanto riguarda **AnyRun**, a causa dei limiti della piattaforma (la versione gratuita accetta infatti file di dimensione $\le$ 16 MB) e al fatto che non è possibile emulare il sistema operativo macOS, è stato testato un file PDF anziché il file dmg

---

La legittimità di questo tipo di analisi è garantita da VirusTotal, che ci mostra come i pdf siano tra i file non eseguibili più pericolosi

![[Screenshot 2024-09-25 alle 16.52.06.png]]

source: https://www.virustotal.com/gui/stats

---

Le informazioni preliminari fornite da AnyRun confermano che il file è effettivamente un PDF, con firme digitali generate utilizzando diverse tecniche di hashing (MD5, SHA1 e SHA256). Ancora una volta, questi hash possono essere impiegati per valutare la potenziale pericolosità del file.

![[Screenshot 2024-09-25 alle 15.30.36.png]]



In questo caso, AnyRun non ha rilevato alcuna minaccia associata al file (`no threats detected`)


![[Screenshot 2024-09-25 alle 15.36.15.png]]


Attraverso un’analisi statica preliminare, AnyRun ha fornito diverse informazioni sul documento sottoposto. In questo caso, i dati relativi all’**autore**, al **produttore**, alla **data di creazione** e al **numero di pagine** risultano coerenti con quelli reperibili online


![[cf135149-ce1e-45a0-bf24-81364bef6485.jpeg]]

Utilizzando l’interfaccia di AnyRun, sono stato in grado di esaminare il contenuto del PDF sottoposto


![[Screenshot 2024-09-25 alle 16.30.26.png|700]]

![[Screenshot 2024-09-25 alle 16.34.43.png]]

L’analisi dei processi avviati durante il test mi ha permesso di identificare due eseguibili: _OpenWith.exe_ (il programma che consente di scegliere quale applicazione utilizzare per aprire il file, come mostrato di seguito) e _Acrobat.exe_ (il visualizzatore di file PDF, mostrato in precedenza)

![[1ab76c5a-f558-4ac2-af36-142993bb8859.jpeg]]

**Non sono quindi stati lanciati in background processi potenzialmente malevoli**

![[Screenshot 2024-09-25 alle 16.44.25.png]]


Per concludere, analizziamo il traffico di rete generato durante l’avvio del programma. In totale, sono state effettuate 14 richieste HTTP, 37 connessioni TCP/UDP e 19 richieste a server DNS, principalmente originate da _Acrobat.exe_


![[Screenshot 2024-09-25 alle 16.45.27.png]]

I server contattati appartengono però ad aziende note: Adobe (adobe.com) e Microsoft (microsoft.com e live.com). Inoltre, nessuno degli indirizzi IP utilizzati nelle connessioni risulta sospetto, in quanto sono presenti nelle "liste di fiducia" (`whitelisted`). Possiamo quindi confermare che il file non contiene alcun tipo di malware.

### Hybrid Analysis

Ho infine sottoposto lo stesso file PDF a Hybrid Analysis per effettuare un confronto tra le due piattaforme

![[Screenshot 2024-09-25 alle 16.59.23.png|400]]

Anche questa volta non sono emerse criticità nel file. Approfondendo l’analisi, anche l’ambiente sandbox **Falcon** di Hybrid Analysis fornisce alcune informazioni di base, come la **firma** del file e il nome del **produttore**

![[Screenshot 2024-09-25 alle 17.15.43.png]]

In questo caso, notiamo l’assenza di alcune informazioni che AnyRun ha invece rilevato, come l’anno di creazione del file. Tuttavia, Hybrid Analysis fornisce una **visualizzazione grafica** del file (`visualization`), un aspetto non offerto dagli altri strumenti. Questo è particolarmente interessante, poiché alcune tecniche di rilevamento di malware basate sull’intelligenza artificiale utilizzano proprio la rappresentazione visiva del file per identificare programmi malevoli

![[screen_2.png|500]]

A differenza di AnyRun, il test di Hybrid Analysis è completamente automatizzato e non consente un’interazione diretta con il file. Tuttavia, come possiamo osservare dall’immagine generata nel report, i test eseguiti sono simili a quelli di AnyRun: il sistema operativo utilizzato è sempre Windows 10 (visibile nella parte inferiore), e il visualizzatore è nuovamente Adobe Reader

![[Screenshot 2024-09-25 alle 17.23.13.png]]

In questo caso, è stato analizzato unicamente il processo generato dall’eseguibile _AcroRd32.exe_ (presumibilmente una versione di Adobe Reader diversa da quella osservata su AnyRun)

![[Screenshot 2024-09-25 alle 17.24.42.png|300]]

Il report generato da Hybrid Analysis risulta purtroppo più limitato rispetto a quello di AnyRun. Si limita infatti a segnalare che nessun processo e nessuna connessione sono stati ritenuti sospetti, ma non fornisce ulteriori dettagli, come gli indirizzi IP contattati o i sottoprocessi avviati
